---
- name: Reboot CentOS7
  shell: sleep 2 && systemctl reboot
  async: 2
  poll: 0
  ignore_errors: true

- name: Pause
  pause:
    seconds: 5

- name: Verify | Determine SSH full connectivity.
  local_action:
    module: "shell sshpass -p {{reboot_password}} ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -o ConnectTimeout=1 -o ConnectionAttempts=1 {{reboot_username}}@{{ansible_host}} -p {{reboot_port}} 'echo success'"
  register: ssh_output
  until: ssh_output.stdout|default('failed') == 'success' 
  retries: 600
  delay: 1
  ignore_errors: yes

